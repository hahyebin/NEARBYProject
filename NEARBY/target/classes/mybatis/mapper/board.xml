<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="com.koreait.nearby.repository.BoardRepository">
 	<resultMap type="Profile" id="ProfileMap">
		<result column="ID" property="id" />
		<result column="P_CONTENT" property="pContent" />
		<result column="P_ORIGIN" property="pOrigin" />
		<result column="P_SAVED" property="pSaved" />
		<result column="P_PATH" property="pPath" />
	</resultMap>
	
	<resultMap type="Likes" id="LikesMap">
		<result column="LIKE_NO" property="likeNo" />
		<result column="B_NO" property="bNo" />
		<result column="ID" property="id" />
		<result column="LIKE_CHECK" property="likeCheck" />
		<result column="LIKE_DATE" property="likeDate" />
	</resultMap>
	
 	<resultMap type="Board" id="BoardMap">
 		<result column="B_NO" property="bNo" />
 		<result column="ID" property="id" />
 		<result column="CONTENT" property="content" />
 		<result column="IP" property="ip" />
 		<result column="LOCATION" property="location" />
 		<result column="ORIGIN" property="origin" />
 		<result column="SAVED" property="saved" />
 		<result column="PATH" property="path" />
 		<result column="LIKES" property="likes" />
 		<result column="CREATED" property="created" />
 		<result column="MODIFIED" property="modified" />
 		<result column="STATE" property="state" />
 		<result column="DEPTH" property="depth" />
 		<result column="GROUPNO" property="groupNo" />
 		<result column="GROUPORD" property="groupOrd" />
 		<collection property="profile" resultMap="ProfileMap" />
 		<collection property="like" resultMap="LikesMap" />
 	</resultMap>
 
 	<!-- 메인 보드 리스트 뿌리기  -->
   <select id="selectListBoard" resultMap="BoardMap">
   	SELECT B.B_NO, B.ID, B.CONTENT, B.IP, B.LOCATION, B.ORIGIN, B.SAVED, B.LIKES, B.CREATED, B.PATH, B.MODIFIED, B.STATE,
   	       P.ID, P.P_ORIGIN, P.P_SAVED, P.P_PATH,
   	       L.LIKE_NO, L.LIKE_CHECK, L.LIKE_DATE
   	 FROM BOARD B LEFT JOIN  PROFILE P
       ON  B.ID = P.ID
     LEFT JOIN  LIKES L
   	   ON B.ID = L.ID
    WHERE STATE = 0
    ORDER BY b.B_NO desc
   </select>
	
  <!-- 게시판 하나 상세보기 -->
	<select id="selectBoardByNo" parameterType="Long" resultMap="BoardMap">
		SELECT  B.B_NO, B.ID, B.CONTENT, B.IP, B.LOCATION, B.ORIGIN, B.SAVED, B.LIKES, B.CREATED, B.PATH, B.MODIFIED, B.STATE, P.ID, P.P_ORIGIN, P.P_SAVED, P.P_PATH, L.LIKE_NO, L.LIKE_CHECK, L.LIKE_DATE
		 FROM BOARD B LEFT JOIN  PROFILE P
           ON  B.ID = P.ID
         right join  LIKES L
   	       ON B.ID = L.ID
	    WHERE B.B_NO = #{bNo}
	       AND STATE = 0
	</select>
	
  <!-- 글 업로드 -->	
	<insert id="insertBoard" parameterType="Board">
		INSERT INTO BOARD
		VALUES ( BOARD_SEQ.NEXTVAL, #{id}, #{content}, #{ip}, #{location}, #{origin}, #{saved}, #{path}, 0, SYSDATE, SYSDATE, 0, 0, 0, 0)
	</insert>
	
  <!-- 글 수정- login id=글 id와 번호 같을 때 수정가능 -->
 	<update id="updateBoard" parameterType="Board">
 		UPDATE BOARD 
 		   SET CONTENT = #{content},
 		       LOCATION = #{location},
 		       PATH = #{path},
 		       ORIGIN = #{origin},
 		       SAVED = #{saved},
 		       MODIFIED = SYSDATE 
 	     WHERE B_NO = #{bNo}
 	</update>
	
	
	<!--  글삭제 -->
	<update id="deleteBoard" parameterType="Map">
		UPDATE BOARD
		   SET STATE = -1
		 WHERE B_NO = #{bNo} and ID = #{id}
	</update>
	
	<!--  조하요 -->
	<update id="boardLike" parameterType="Board">
		UPDATE BOARD 
		  SET LIKES = LIKES + 1
		WHERE B_NO=#{bNo}
	</update>
	
	<!--  좋아요 취소 -->
	<update id="boardLikeCancel" parameterType="Board">
		UPDATE BOARD 
		  SET LIKES = LIKES - 1
		WHERE B_NO=#{bNo}
	</update>
	
	<!--  좋아요 카운트  -->
	<select id="boardLikesCount" parameterType="Board" resultType="Board">
		SELECT LIKES 
		  FROM BOARD
		 WHERE B_NO= #{bNo}
	</select>
	   
	   
	   <!-- 지역  -->
	<select id="adminBoardList" resultMap="BoardMap">
        SELECT B.B_NO, B.ID, b.CONTENT, B.IP, B.LOCATION, B.ORIGIN, B.SAVED, B.LIKES, B.CREATED, B.PATH, B.MODIFIED, B.STATE
          FROM BOARD B 
         WHERE B.STATE = 0
    </select>
	
	
	
	
	
	
</mapper>